FROM microsoft/dotnet:2.1-runtime-deps
COPY ./app/. ./App/.

ENV TWCORE_FORCE_ENVIRONMENT=Docker
ENV DIAGNOSTICS_QUEUE_ROUTE=amqp://test:test@127.0.0.1:5672/
ENV DIAGNOSTICS_QUEUE_NAME=DIAGNOSTICS_RQ
ENV DIAGNOSTICS_STATUS_HTTP_PORT=28905
ENV DIAGNOSTICS_RAVENDB_DATABASE=Diagnostics
ENV DIAGNOSTICS_RAVENDB_URLS=http://127.0.0.1:8080

EXPOSE 55999/tcp
EXPOSE 28905/tcp

VOLUME /App/logs
VOLUME /App/settings
VOLUME /App/assemblies

WORKDIR /App
ENTRYPOINT [ "./TWCore.Diagnostics.Api" ]